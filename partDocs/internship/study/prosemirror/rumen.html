<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>富文本编辑器从伤感到破局 | 前端基础百炼成仙</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/Hundred-refining-into-Immortals/logo.jpg">
    <meta name="description" content="">
    
    <link rel="preload" href="/Hundred-refining-into-Immortals/assets/css/0.styles.5bd8dc3d.css" as="style"><link rel="preload" href="/Hundred-refining-into-Immortals/assets/js/app.da1455f9.js" as="script"><link rel="preload" href="/Hundred-refining-into-Immortals/assets/js/2.75968125.js" as="script"><link rel="preload" href="/Hundred-refining-into-Immortals/assets/js/45.324c06b4.js" as="script"><link rel="preload" href="/Hundred-refining-into-Immortals/assets/js/10.87460a67.js" as="script"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/11.a8a97867.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/12.3c120ecd.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/13.1b9dd9b1.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/14.18f5eb3b.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/15.67688b32.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/16.e3f3a28c.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/17.2a222e0e.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/18.b45aec24.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/19.a8ced1a4.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/20.80b86273.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/21.1202dbdf.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/22.fd12c5bb.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/23.70bd34a4.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/24.3039c124.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/25.51ff4fd6.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/26.504ec63f.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/27.b828db12.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/28.f4be1181.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/29.fa0841f4.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/3.6aa9ba9a.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/30.cb2100b2.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/31.d0afc589.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/32.9ff2cb3e.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/33.38a861a2.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/34.307ad15f.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/35.1349e407.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/36.c34298fe.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/37.790d5a3c.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/38.84a8e6e0.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/39.f2e6082d.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/4.19449fff.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/40.bedb0ca4.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/41.cb1ada15.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/42.0cfe506c.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/43.8b7feacc.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/44.2627a6b6.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/46.66f94539.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/47.b144fec6.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/48.1a180565.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/49.ddb31aeb.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/5.a9dd5540.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/50.3912e2c1.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/51.22755c00.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/52.568c62bd.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/53.03eeeaca.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/54.65603fb1.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/55.3c860a1a.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/56.dcac6e09.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/57.81245aa6.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/58.3548b3fc.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/59.b70ff938.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/6.c4ef703b.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/60.54959e8e.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/61.9574d37d.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/62.50ad37e7.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/63.5e509b76.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/64.fc588507.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/65.afdde58c.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/66.c1bcbe18.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/67.db82fdee.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/68.547c6b01.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/69.5485b583.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/7.7751eb02.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/70.e79e045a.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/71.a5ebd2c8.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/72.a10449b6.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/73.2714a3ec.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/74.9481b170.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/75.0e058528.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/76.a7a0fb7c.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/77.76e4da6b.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/78.75f15171.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/79.93be61e7.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/8.d6a9de4c.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/80.0739cadd.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/81.830b16ef.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/82.2f099d2f.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/83.1c599310.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/84.3d2255cd.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/85.bc5752c4.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/86.302df6fc.js"><link rel="prefetch" href="/Hundred-refining-into-Immortals/assets/js/9.97ce9281.js">
    <link rel="stylesheet" href="/Hundred-refining-into-Immortals/assets/css/0.styles.5bd8dc3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Hundred-refining-into-Immortals/" class="home-link router-link-active"><img src="/Hundred-refining-into-Immortals/logo.jpg" alt="前端基础百炼成仙" class="logo"> <span class="site-name can-hide">前端基础百炼成仙</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Hundred-refining-into-Immortals/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/Hundred-refining-into-Immortals/partDocs/leetcode.html" class="nav-link">
  LeetCode
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端知识点" class="dropdown-title"><span class="title">前端知识点</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端知识点" class="mobile-dropdown-title"><span class="title">前端知识点</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端三项之力
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/html/html.html" class="nav-link">
  HTML
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/css/css.html" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/javascript/javascript.html" class="nav-link">
  Javascript
</a></li></ul></li><li class="dropdown-item"><h4>
          前端两大框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/vue/vue.html" class="nav-link">
  Vue
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/react/react.html" class="nav-link">
  React
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实习笔记" class="dropdown-title"><span class="title">实习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="实习笔记" class="mobile-dropdown-title"><span class="title">实习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Hundred-refining-into-Immortals/partDocs/internship/internship.html" class="nav-link">
  写在前面
</a></li><li class="dropdown-item"><h4>
          乱七八糟的学习
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/charles.html" class="nav-link">
  Charles学习
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/git/peizhi.html" class="nav-link">
  Git学习
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/typescript/type.html" class="nav-link">
  TypeScript学习
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/react/react.html" class="nav-link">
  React学习
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/flutter/flutter.html" class="nav-link">
  Flutter学习
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/prosemirror/prosemirror.html" class="nav-link">
  ProseMirror学习
</a></li></ul></li><li class="dropdown-item"><h4>
          乱七八糟的笔记
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/write/bootcamp.html" class="nav-link">
  Bootcamp学习笔记
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/write/vscode.html" class="nav-link">
  vscode好用插件
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/write/question.html" class="nav-link">
  实习提问
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/write/bug/bug.html" class="nav-link">
  Bug回忆录
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作日志" class="dropdown-title"><span class="title">工作日志</span> <span class="arrow down"></span></button> <button type="button" aria-label="工作日志" class="mobile-dropdown-title"><span class="title">工作日志</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Hundred-refining-into-Immortals/partDocs/worklog/worklog.html" class="nav-link">
  写在前面
</a></li><li class="dropdown-item"><h4>
          正式工作前
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/worklog/before/research/research.html" class="nav-link">
  科研成果记录
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/worklog/before/css.html" class="nav-link">
  css权威指南读书笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于我" class="dropdown-title"><span class="title">关于我</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于我" class="mobile-dropdown-title"><span class="title">关于我</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Hundred-refining-into-Immortals/partDocs/aboutme/aboutme.html" class="nav-link">
  关于我
</a></li><li class="dropdown-item"><!----> <a href="/Hundred-refining-into-Immortals/partDocs/aboutme/biography.html" class="nav-link">
  本科个人传记
</a></li><li class="dropdown-item"><!----> <a href="/Hundred-refining-into-Immortals/partDocs/aboutme/thanks.html" class="nav-link">
  硕士毕业致谢
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/KamenRider41" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/qq_42136832" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1108753576635751/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://space.bilibili.com/27424293" target="_blank" rel="noopener noreferrer" class="nav-link external">
  B站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Hundred-refining-into-Immortals/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/Hundred-refining-into-Immortals/partDocs/leetcode.html" class="nav-link">
  LeetCode
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端知识点" class="dropdown-title"><span class="title">前端知识点</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端知识点" class="mobile-dropdown-title"><span class="title">前端知识点</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端三项之力
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/html/html.html" class="nav-link">
  HTML
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/css/css.html" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/javascript/javascript.html" class="nav-link">
  Javascript
</a></li></ul></li><li class="dropdown-item"><h4>
          前端两大框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/vue/vue.html" class="nav-link">
  Vue
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/react/react.html" class="nav-link">
  React
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实习笔记" class="dropdown-title"><span class="title">实习笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="实习笔记" class="mobile-dropdown-title"><span class="title">实习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Hundred-refining-into-Immortals/partDocs/internship/internship.html" class="nav-link">
  写在前面
</a></li><li class="dropdown-item"><h4>
          乱七八糟的学习
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/charles.html" class="nav-link">
  Charles学习
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/git/peizhi.html" class="nav-link">
  Git学习
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/typescript/type.html" class="nav-link">
  TypeScript学习
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/react/react.html" class="nav-link">
  React学习
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/flutter/flutter.html" class="nav-link">
  Flutter学习
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/prosemirror/prosemirror.html" class="nav-link">
  ProseMirror学习
</a></li></ul></li><li class="dropdown-item"><h4>
          乱七八糟的笔记
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/write/bootcamp.html" class="nav-link">
  Bootcamp学习笔记
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/write/vscode.html" class="nav-link">
  vscode好用插件
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/write/question.html" class="nav-link">
  实习提问
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/internship/write/bug/bug.html" class="nav-link">
  Bug回忆录
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作日志" class="dropdown-title"><span class="title">工作日志</span> <span class="arrow down"></span></button> <button type="button" aria-label="工作日志" class="mobile-dropdown-title"><span class="title">工作日志</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Hundred-refining-into-Immortals/partDocs/worklog/worklog.html" class="nav-link">
  写在前面
</a></li><li class="dropdown-item"><h4>
          正式工作前
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/worklog/before/research/research.html" class="nav-link">
  科研成果记录
</a></li><li class="dropdown-subitem"><a href="/Hundred-refining-into-Immortals/partDocs/worklog/before/css.html" class="nav-link">
  css权威指南读书笔记
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于我" class="dropdown-title"><span class="title">关于我</span> <span class="arrow down"></span></button> <button type="button" aria-label="关于我" class="mobile-dropdown-title"><span class="title">关于我</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Hundred-refining-into-Immortals/partDocs/aboutme/aboutme.html" class="nav-link">
  关于我
</a></li><li class="dropdown-item"><!----> <a href="/Hundred-refining-into-Immortals/partDocs/aboutme/biography.html" class="nav-link">
  本科个人传记
</a></li><li class="dropdown-item"><!----> <a href="/Hundred-refining-into-Immortals/partDocs/aboutme/thanks.html" class="nav-link">
  硕士毕业致谢
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/KamenRider41" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/qq_42136832" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/1108753576635751/posts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://space.bilibili.com/27424293" target="_blank" rel="noopener noreferrer" class="nav-link external">
  B站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>实习笔记</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Hundred-refining-into-Immortals/partDocs/internship/internship.html" class="sidebar-link">写在前面</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>乱七八糟的学习</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/charles.html" class="sidebar-link">Charles学习</a></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>Git学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>TypeScript学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>React学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading"><span>Flutter学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><p class="sidebar-heading open"><span>ProseMirror学习</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/prosemirror/prosemirror.html" class="sidebar-link">写在前面</a></li><li><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/prosemirror/rumen.html" aria-current="page" class="active sidebar-link">编辑器从伤感到破局</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/prosemirror/rumen.html#伤感" class="sidebar-link">伤感</a></li><li class="sidebar-sub-header"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/prosemirror/rumen.html#破局" class="sidebar-link">破局</a></li><li class="sidebar-sub-header"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/prosemirror/rumen.html#代码结构" class="sidebar-link">代码结构</a></li><li class="sidebar-sub-header"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/prosemirror/rumen.html#典型流程" class="sidebar-link">典型流程</a></li><li class="sidebar-sub-header"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/prosemirror/rumen.html#state层" class="sidebar-link">State层</a></li><li class="sidebar-sub-header"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/prosemirror/rumen.html#view层" class="sidebar-link">view层</a></li><li class="sidebar-sub-header"><a href="/Hundred-refining-into-Immortals/partDocs/internship/study/prosemirror/rumen.html#transform层" class="sidebar-link">transform层</a></li></ul></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>乱七八糟的笔记</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="富文本编辑器从伤感到破局"><a href="#富文本编辑器从伤感到破局" class="header-anchor">#</a> 富文本编辑器从伤感到破局</h1> <p></p><div class="table-of-contents"><ul><li><a href="#伤感">伤感</a></li><li><a href="#破局">破局</a><ul><li><a href="#state">State</a></li></ul></li><li><a href="#代码结构">代码结构</a></li><li><a href="#典型流程">典型流程</a><ul><li><a href="#初始化流程">初始化流程</a></li><li><a href="#更新流程">更新流程</a></li></ul></li><li><a href="#state层">State层</a><ul><li><a href="#文档结构">文档结构</a></li></ul></li><li><a href="#view层">view层</a></li><li><a href="#transform层">transform层</a></li></ul></div><p></p> <h2 id="伤感"><a href="#伤感" class="header-anchor">#</a> 伤感</h2> <p>浏览器提供了 contenteditable 使得元素可以编辑，以及 document.execCommand 让 js 具备能力去改变元素。但直接用这两个能力去做富文本编辑器是很坑的:参考文章</p> <ul><li>什么是contentEditable MDN解释
<ul><li>contentEditable实际上是浏览器厂商提供的一个富文本编辑器的实现方案。通过设置一个dom的contenteditable属性为true，可以让这个DOM变得可以编辑。</li></ul></li> <li>什么是document.execCommand MDN解释
<ul><li>当一段document被转为designMode（contentEditable 和 input框）的时候，document.execCommand的command会作用于光标选区（加粗，斜体等操作），也可能会插入一个新的元素，也可能会影响当前行的内容，取决于command是啥。</li></ul></li> <li>坑
<ul><li>不可预测的表现:比如标签被吃了，出现多余的标签</li> <li>行内标签嵌套,ab和ba是一样的</li> <li>...</li></ul></li></ul> <p>ContentEditable 是一种在web浏览器上进行富文本编辑的本地原生组件. 它是那样让人…伤感.</p> <hr> <h2 id="破局"><a href="#破局" class="header-anchor">#</a> 破局</h2> <p>我们知道React和Vue都有虚拟dom，那么这里差不多是一样的
操作一个简单的JS对象一定是比操作DOM要简单的，这屏蔽了浏览器差异，规避了DOM复杂的特性。</p> <h3 id="state"><a href="#state" class="header-anchor">#</a> State</h3> <p>首先，我们在View和command之间引入一个state。在数据存储层面，我们就不需要维护复杂的DOM结构了，可以用一个JS object的结构去维护当前结构</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'p'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><p>OK，可以看到这是一个树状的结构，那么针对下面这种结构</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
  text <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>span text<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在我们的Editor State中怎么表示呢？我们需要修改以下上边的那个状态</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'p'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'textNode'</span><span class="token punctuation">,</span> <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'text '</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'textNode'</span><span class="token punctuation">,</span> <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'span text'</span><span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><ul><li>还是有问题
<ul><li>ui没变state一直在变，比如</li></ul></li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
  text <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>strong<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>italic text<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
  text <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>strong<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>italic text<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>这两个ui是一样的，但是state却在发生变化
<ul><li>这样的树状的结构导致我们操作跨层级的DOM十分不方便（更新这个state的时候更困难，确定边界困难）</li></ul></li></ul> <h4 id="如何让行内标签不影响dom结构呢"><a href="#如何让行内标签不影响dom结构呢" class="header-anchor">#</a> 如何让行内标签不影响dom结构呢？</h4> <ul><li>我们实际上是可以把他作为style处理的，比如 strong 我们可以等价于 font-weight: bold, em 可以等价于 font-style: italic。</li> <li>让我们加一个叫marks的属性来表示这些修饰用的行内标签。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'p'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token literal-property property">marks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'textNode'</span><span class="token punctuation">,</span> <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'text '</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'textNode'</span><span class="token punctuation">,</span> <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">marks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'strong'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'strong'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'textNode'</span><span class="token punctuation">,</span> <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token literal-property property">marks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'strong'</span><span class="token punctuation">,</span><span class="token string">'em'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'italic text'</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><ul><li>继续，可以看到我们上面还写了style，表示我们的标签可以有样式，既然如此，我们再扩展一下，加个东西叫attributes，既可以容纳样式，也可以容纳类，id，dataset等一系列东西。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'p'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">attrs</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'textNode'</span><span class="token punctuation">,</span> <span class="token literal-property property">attrs</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'text '</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'textNode'</span><span class="token punctuation">,</span> <span class="token literal-property property">attrs</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">marks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'strong'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'strong'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'textNode'</span><span class="token punctuation">,</span> <span class="token literal-property property">attrs</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token literal-property property">marks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'strong'</span><span class="token punctuation">,</span><span class="token string">'em'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'italic text'</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><h4 id="strong和em也有样式-怎么办"><a href="#strong和em也有样式-怎么办" class="header-anchor">#</a> strong和em也有样式，怎么办？</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">NodeAndMarkGen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">nodeType<span class="token punctuation">,</span> attrs</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> nodeType<span class="token punctuation">,</span>
    <span class="token literal-property property">attrs</span><span class="token operator">:</span> attrs
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> paragraph <span class="token operator">=</span> <span class="token function">NodeAndMarkGen</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> textNode <span class="token operator">=</span> <span class="token function">NodeAndMarkGen</span><span class="token punctuation">(</span><span class="token string">'textNode'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> strong <span class="token operator">=</span> <span class="token function">NodeAndMarkGen</span><span class="token punctuation">(</span><span class="token string">'strong'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> em <span class="token operator">=</span> <span class="token function">NodeAndMarkGen</span><span class="token punctuation">(</span><span class="token string">'em'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token operator">...</span>p
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token operator">...</span>textNode<span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'text '</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token operator">...</span>textNode<span class="token punctuation">,</span> <span class="token literal-property property">marks</span><span class="token operator">:</span> <span class="token punctuation">[</span>strong<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'strong'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token operator">...</span>textNode<span class="token punctuation">,</span> <span class="token literal-property property">marks</span><span class="token operator">:</span> <span class="token punctuation">[</span>strong<span class="token punctuation">,</span> em<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'italic text'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><p>到这里，我们就解决了一下如何存储编辑器状态的问题，结构清晰易懂。但是实际上还没有解决任何真正的问题，比如上面说的回车啊，标签嵌套混乱。</p> <hr> <h1 id="prosemirror"><a href="#prosemirror" class="header-anchor">#</a> ProseMirror</h1> <p><img src="/Hundred-refining-into-Immortals/pm1.png"></p> <h2 id="代码结构"><a href="#代码结构" class="header-anchor">#</a> 代码结构</h2> <ul><li>prosemirror核心有四个模块
<ul><li>prosemirror-model：定义编辑器的文档模型，用来描述编辑器内容的数据结构</li> <li>prosemirror-state：描述编辑器整体状态,包括文档数据，选择等</li> <li>prosemirror-view：UI组件，用于将编辑器状态展现为可编辑的元素，处理用户交互</li> <li>prosemirror-transform：修改文档的事务方法</li></ul></li> <li>下面我们就从state，view，transform三个方面来探索prosemirror的实现原理</li></ul> <h2 id="典型流程"><a href="#典型流程" class="header-anchor">#</a> 典型流程</h2> <h3 id="初始化流程"><a href="#初始化流程" class="header-anchor">#</a> 初始化流程</h3> <ul><li>首先看一下prosemirror的初始化代码</li></ul> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">// 创建schema</span>
<span class="token keyword">const</span> demoSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">nodes</span><span class="token operator">:</span> <span class="token function">addListNodes</span><span class="token punctuation">(</span>schema<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>nodes<span class="token punctuation">,</span> <span class="token string">&quot;paragraph block*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;block&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">marks</span><span class="token operator">:</span> schema<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>marks
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 创建state</span>
<span class="token keyword">let</span> state <span class="token operator">=</span> EditorState<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">doc</span><span class="token operator">:</span> DOMParser<span class="token punctuation">.</span><span class="token function">fromSchema</span><span class="token punctuation">(</span>demoSchema<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#content&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token function">exampleSetup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">schema</span><span class="token operator">:</span> demoSchema <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 创建view</span>
<span class="token keyword">let</span> view <span class="token operator">=</span> <span class="token function">EditorView</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.full'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> state <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>初始化的代码非常清晰，先是创建文档数据的规范标准，类似约定了数据协议。其次创建了 state，state 是需要满足 schema 规范的。最后根据 state 创建了 view，view 就是最终展现在用户面前的富文本编辑器UI。因为初始化的时候还没有用户操作的介入，所以并不涉及 command 也就是 transform 的引入。</p> <p><img src="/Hundred-refining-into-Immortals/pm2.png"></p> <ul><li>因为此类架构的富文本编辑器本质是 F(state) = view ，界面是由数据驱动的
<ul><li>而 contenteditable 的元素又是非受控的，所以保证状态和界面的一致性是非常重要的。</li> <li>是不是很快就想到了React中的input组件在受控和非受控下的差异
<ul><li>非受控的时候我们是通过ref来改变的</li></ul></li></ul></li></ul> <h3 id="更新流程"><a href="#更新流程" class="header-anchor">#</a> 更新流程</h3> <p><img src="/Hundred-refining-into-Immortals/pm3.png"></p> <ul><li>可以看到输入字符会触发 view 变化，继而更新 state ，保证 state 和 view 的一致性。如果我们输入的是自定义的元素，就会在触发 state 更新之后，再通过 updateState 方法更新 view，展示自定义的元素。</li></ul> <h2 id="state层"><a href="#state层" class="header-anchor">#</a> State层</h2> <ul><li>prosemirror 的 state 并不是固定的，而是可以扩展的，但其有基本的四个属性：
<ul><li>doc(最核心)
<ul><li>在初始化流程中，DOMParser 会把初始富文本信息同步到 doc 属性中。</li></ul></li> <li>selection</li> <li>storedMarks</li> <li>scrollToSelection</li></ul></li></ul> <hr> <p>每一次编辑都会产生一份新的编辑器数据，如何优化存储，也是比较有意思的话题，不在本文描述。</p> <p>另外值得提一嘴的是，其 plugin 机制也是基于 state 来做的。</p> <h3 id="文档结构"><a href="#文档结构" class="header-anchor">#</a> 文档结构</h3> <p>众所周知，HTML的文档结构是树状的，而 prosemirror 采用的是基于 inline + mark 的数据结构。 每个文档就是一个 node ， node 包含一个 fragment ，fragment 包含一个或者多个子 node 。其中核心是 node 的数据结构。</p> <p><img src="/Hundred-refining-into-Immortals/pm4.png"></p> <p>这个在破局里面其实已经提到过了！</p> <ul><li>这种inline，mark的写法可以保证文档的稳定性</li> <li>除了上述这个优点以外，针对富文本编辑这个场景，这种数据结构还有其他的优势。
<ul><li>更符合用户对文本操作的直观感受，可以通过偏移量来描述位置，更加轻易的做分割。</li> <li>通过偏移量来操作性能上会比操作树要好很多。</li></ul></li></ul> <h2 id="view层"><a href="#view层" class="header-anchor">#</a> view层</h2> <p>view 调用 updateState （也就是根据 state 来更新视图, 在更新流程中有提到）时，会调用节点的 toDOM 方法来创建 DOM 元素，从而渲染到浏览器上。</p> <p>相应的还有 parseDOM 方法，可以根据 DOM 元素，序列化成文档数据。</p> <p>每次初始化，或者有 state 有更新的时候，都会触发 updateState 方法，从而完成界面的更新。</p> <h2 id="transform层"><a href="#transform层" class="header-anchor">#</a> transform层</h2> <p>在更新流程中，当 view 发生变化时，会构建 transaction （其父类就是 transform），来更新 state。</p> <p>通过该堆栈可以发现，在富文本编辑器输入内容的时候，会触发 DOM 变更事件，进而通过 view.state.tr.insertText 来创建一个 insertText 的 transaction。一个 transaction 内部有一个或者多个 step ，insertText 这个 transaction 内部只有一个 ReplaceStep。</p> <p>prosemirror 内置的 Step 包括：</p> <ul><li>AddMarkStep</li> <li>RemoveMarkStep</li> <li>ReplaceStep</li> <li>ReplaceAroundStep
这些 step 都有核心的两个方法，一个是 apply ，另外一个是 invert 。apply 就是运行这个 step ， invert 就是恢复用的动作。这对于做回退操作是非常有用的。</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">lastUpdate:</span> <span class="time">4/2/2023, 8:18:35 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Hundred-refining-into-Immortals/partDocs/internship/study/prosemirror/prosemirror.html" class="prev">
        写在前面
      </a></span> <span class="next"><a href="/Hundred-refining-into-Immortals/partDocs/internship/write/bootcamp.html">
        Bootcamp学习笔记
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/Hundred-refining-into-Immortals/assets/js/app.da1455f9.js" defer></script><script src="/Hundred-refining-into-Immortals/assets/js/2.75968125.js" defer></script><script src="/Hundred-refining-into-Immortals/assets/js/45.324c06b4.js" defer></script><script src="/Hundred-refining-into-Immortals/assets/js/10.87460a67.js" defer></script>
  </body>
</html>
